### TO BE READ:
https://github.com/prigoyal/pytorch_memonger
https://github.com/prigoyal/pytorch_memonger/blob/master/tutorial/Checkpointing_for_PyTorch_models.ipynb
https://github.com/pytorch/pytorch/issues/1529#issuecomment-339649776
https://nihcc.app.box.com/v/ChestXray-NIHCC/folder/37178474737

READ PAPERS ABOUT PNEUMONIA + ML OR CHEXNET???

Tips: 
before starting a new experiment, create a local copy of ckpt, model and events log file with a little documentation.


## 10oct => all augmentations for train

CLS_THRESH: mAP
model at 17 epoch:
964it [03:06,  5.17it/s]
0.15 -> 0.21 = 28.07
0.22 -> 0.25 = 27.76
0.26 -> 0.28 = 27.35
0.29 -> 0.33 = 27.03
0.34 -> 0.35 = 26.57
Calculating mAP...
avg precs:  [0.47, 0.4148, 0.375, 0.3124, 0.2483, 0.1847, 0.1363, 0.1042]
iou_thrs:   [0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75]
CLS_THRESH: 0.15, mAP: 28.07
Calculating mAP...
avg precs:  [0.47, 0.4148, 0.375, 0.3124, 0.2483, 0.1847, 0.1363, 0.1042]
iou_thrs:   [0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75]
CLS_THRESH: 0.16, mAP: 28.07
Calculating mAP...
avg precs:  [0.47, 0.4148, 0.375, 0.3124, 0.2483, 0.1847, 0.1363, 0.1042]
iou_thrs:   [0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75]
CLS_THRESH: 0.17, mAP: 28.07
Calculating mAP...
avg precs:  [0.47, 0.4148, 0.375, 0.3124, 0.2483, 0.1847, 0.1363, 0.1042]
iou_thrs:   [0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75]
CLS_THRESH: 0.18, mAP: 28.07
Calculating mAP...
avg precs:  [0.47, 0.4148, 0.375, 0.3124, 0.2483, 0.1847, 0.1363, 0.1042]
iou_thrs:   [0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75]
CLS_THRESH: 0.19, mAP: 28.07
Calculating mAP...
avg precs:  [0.47, 0.4148, 0.375, 0.3124, 0.2483, 0.1847, 0.1363, 0.1042]
iou_thrs:   [0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75]
CLS_THRESH: 0.20, mAP: 28.07
Calculating mAP...
avg precs:  [0.47, 0.4148, 0.375, 0.3124, 0.2483, 0.1847, 0.1363, 0.1042]
iou_thrs:   [0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75]
CLS_THRESH: 0.21, mAP: 28.07
Calculating mAP...
avg precs:  [0.47, 0.4148, 0.35, 0.3124, 0.2483, 0.1847, 0.1363, 0.1042]
iou_thrs:   [0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75]
CLS_THRESH: 0.22, mAP: 27.76
Calculating mAP...
avg precs:  [0.47, 0.4148, 0.35, 0.3124, 0.2483, 0.1847, 0.1363, 0.1042]
iou_thrs:   [0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75]
CLS_THRESH: 0.23, mAP: 27.76
Calculating mAP...
avg precs:  [0.47, 0.4148, 0.35, 0.3124, 0.2483, 0.1847, 0.1363, 0.1042]
iou_thrs:   [0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75]
CLS_THRESH: 0.24, mAP: 27.76
Calculating mAP...
avg precs:  [0.47, 0.4148, 0.35, 0.3124, 0.2483, 0.1847, 0.1363, 0.1042]
iou_thrs:   [0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75]
CLS_THRESH: 0.25, mAP: 27.76
Calculating mAP...
avg precs:  [0.4372, 0.4148, 0.35, 0.3124, 0.2483, 0.1847, 0.1363, 0.1042]
iou_thrs:   [0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75]
CLS_THRESH: 0.26, mAP: 27.35
Calculating mAP...
avg precs:  [0.4372, 0.4148, 0.35, 0.3124, 0.2483, 0.1847, 0.1363, 0.1042]
iou_thrs:   [0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75]
CLS_THRESH: 0.27, mAP: 27.35
Calculating mAP...
avg precs:  [0.4372, 0.4148, 0.35, 0.3124, 0.2483, 0.1847, 0.1363, 0.1042]
iou_thrs:   [0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75]
CLS_THRESH: 0.28, mAP: 27.35
Calculating mAP...
avg precs:  [0.4372, 0.4148, 0.35, 0.2866, 0.2483, 0.1847, 0.1363, 0.1042]
iou_thrs:   [0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75]
CLS_THRESH: 0.29, mAP: 27.03
Calculating mAP...
avg precs:  [0.4372, 0.4148, 0.35, 0.2866, 0.2483, 0.1847, 0.1363, 0.1042]
iou_thrs:   [0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75]
CLS_THRESH: 0.30, mAP: 27.03
Calculating mAP...
avg precs:  [0.4372, 0.4148, 0.35, 0.2866, 0.2483, 0.1847, 0.1363, 0.1042]
iou_thrs:   [0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75]
CLS_THRESH: 0.31, mAP: 27.03
Calculating mAP...
avg precs:  [0.4372, 0.4148, 0.35, 0.2866, 0.2483, 0.1847, 0.1363, 0.1042]
iou_thrs:   [0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75]
CLS_THRESH: 0.32, mAP: 27.03
Calculating mAP...
avg precs:  [0.4372, 0.4148, 0.35, 0.2866, 0.2483, 0.1847, 0.1363, 0.1042]
iou_thrs:   [0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75]
CLS_THRESH: 0.33, mAP: 27.03
Calculating mAP...
avg precs:  [0.4372, 0.3781, 0.35, 0.2866, 0.2483, 0.1847, 0.1363, 0.1042]
iou_thrs:   [0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75]
CLS_THRESH: 0.34, mAP: 26.57
Calculating mAP...
avg precs:  [0.4372, 0.3781, 0.35, 0.2866, 0.2483, 0.1847, 0.1363, 0.1042]
iou_thrs:   [0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75]
CLS_THRESH: 0.35, mAP: 26.57

vast9oct2
# #mAP in threading, model.pth at 15 epoch
# Note: below at CLS_THRESH = 0.3
avg precs:  [0.4372, 0.4148, 0.35, 0.2866, 0.2483, 0.1847, 0.1363, 0.1042]
iou_thrs:   [0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75]
mAP: 0.2702625

vast8oct3 
## trained with no expand/crop in aug
## and mean subtraction (not /255.)

vast 8oct3, model 30.pth

mAPs at different class score thresholds are:
0.1 :  0.07104562617318712
0.15 :  0.07543593163406447
0.2 :  0.07595197959889355  # 0.178
0.25 :  0.07480441735822961  # 0.182
0.3 :  0.07369305411479946   # 0.177
0.35 :  0.0702103864107884
0.4 :  0.06508525674273857
0.45 :  0.06070355722683264
0.5 :  0.0537609137275242
0.55 :  0.0450488416320885

model20.pth

0.1 :  0.05735791805877392
0.15 :  0.06814766103536851
0.2 :  0.07377301607883817
0.25 :  0.0761556664937759  # 0.182 on LB
0.3 :  0.07581042531120331
0.35 :  0.07208733143153526
0.4 :  0.06629549187413548
0.45 :  0.05959327455048405
0.5 :  0.052042812067773135
0.55 :  0.042987659923928084

model10.pth
0.3 :  0.07581042531120324  # 0.171
0.35 :  0.07208733143153523
0.4 :  0.06629549187413553
0.45 :  0.05959327455048408
0.5 :  0.052042812067773156
0.55 :  0.042987659923928105


vast8oct2/model10.pth
## only val augmentation 
0.3 :  0.05242248062015506
0.35 :  0.0457202842377261                                                         
0.4 :  0.037697835917312655                                                         
0.45 :  0.026477713178294563                                                       
0.5 :  0.020566860465116275
0.55 :  0.012152777777777776  

vast8oct/model20.pth

0.3 :  0.0563397709627329
0.35 :  0.05504092261904762
0.4 :  0.05340725284679091
0.45 :  0.0500186011904762
0.5 :  0.04485717520703935
0.55 :  0.03731964932712216



vast7oct/model10.pth
val: (8mins)
0.3 :  0.08007408126293993
0.35 :  0.07797133799171838
0.4 :  0.07367688923395443
0.45 :  0.06716647256728778
0.5 :  0.05941462862318841
0.55 :  0.05140802924430642

train: (53 mins)
0.3 :  0.08617854310842007
0.35 :  0.08284899437716291
0.4 :  0.07857509731833935
0.45 :  0.07289431949250313
0.5 :  0.06528997260669
0.55 :  0.055003964821222676

vast7oct/model20.pth
0.3 :  0.07800692287784686
0.35 :  0.0785439311594203  # 0.35
0.4 :  0.07598990683229817
0.45 :  0.07206101190476191
0.5 :  0.06872088509316772
0.55 :  0.061725219979296087  


# NOTE: vast/*.pth are overfitted model. Due to a bug, they were trained on whole of dataset so val set mAP is not actually "val set" mAP!

vast/model50.pth
0.3 :  0.170599605331263
0.35 :  0.1711034549689442
0.4 :  0.1705413755175984
0.45 :  0.17162509704968948
0.5 :  0.16991459627329195
0.55 :  0.16841841356107662


vast/model80.pth
0.3 :  0.1904349443581781
0.35 :  0.19019232013457557
0.4 :  0.19006292054865426
0.45 :  0.19054816899585925
0.5 :  0.19054816899585925
0.55 :  0.19019232013457557


model80.pth and model50.pth had bugs, overfitted

model80.pth > model50.pth on val set but on submision model80.pth (0.34) < model50.pth (0.37)
